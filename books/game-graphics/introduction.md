---
title: "はじめに"
free: true
---

## 講義概要

### 何を学ぶのか

3 次元コンピュータグラフィックス (3DCG) の基礎理論を習得することを目的に、3D ゲームの映像生成に用いられるリアルタイムレンダリングの手法のほか、アニメーションなどの各種の手法について、OpenGL および GLSL (OpenGL Shading Language) による実装をもとに学習します。

### 何の役に立つのか

3D ゲーム開発に必要となる、グラフィックスプログラミングの基本的なスキルを身に付けることを目標とします。しかし、その下地である 3DCG の理論や、そこで用いられている数学や物理の基礎知識、各種のアルゴリズムやプログラミングテクニック、数値計算法などは、一般的なコンピュータのプログラミングにおいても有用です。これらの学習を通じて、コンピュータのプログラミングが少しだけ「うまく」できるようになることも狙います。

### プログラミングスキルを向上するために

プログラミングは本を読んだり話を聞いたりしただけでは身に付けることはできません。教科書に書かれているプログラミング言語の文法は、自分の課題を解決してくれる答えではありません。自分で何をプログラムするかということを決めておく必要があります。そのためには対象に対する知識や基礎的な理論が必要になります。

でも、何をプログラムするかを決めても、それをどのように実装すればいいかは分かりません。それでもプログラムは、書かないと書けるようになりません。そこにプログラミングが苦手という人のパラドックスがあります。書けないのに、書くことなんてできないと思ってしまうのです。

でもそれは、書くための準備をしていないだけなのです。最初に何をしたらいいのか分からないのではなくて、最初にやることを決めていないだけなのです。そして、それを決めるために、課題を「分析」して解決しなければならない問題を発見してください。そして、それを分解したり抽象化したり、あるいは一般化や定式化を行って、現実の問題から切り離してください。この作業はモデル化と言います。モデル化によって問題を現実から切り離してしまえば、それをプログラムできる形に直すことができるようになります。このような考え方を「プログラミング的思考」と言います。

## ゲームグラフィックス

### ゲームと 3DCG

コンピュータグラフィックス (CG) はコンピュータによって作成されたグラフィックスや、そのための技術のことを言います。またゲームグラフィックスはゲームに使われるグラフィックスのことをいい、これには写真やイラスト、図版、テクスチャ、およびアニメーションなどの映像素材があります。ゲームグラフィックスが一般的な映像素材と異なる点は、これらの中に、コンピュータによって動的に生成されるものが含まれるところにあります。その意味でゲームグラフィックスは CG にほかなりません。

ただ、CG には映画の映像のように、あらかじめ時間をかけて生成されるものも含まれます。これに対してゲームグラフィックスでは、プレイヤーの操作に応じて映像を「その場」で生成する必要があります。このような CG をリアルタイムCG といいます。特に、最近のゲームはシーンを 3 次元で表現するものが主流になっていますから、ゲームグラフィックスの技術は、リアルタイム 3DCGの技術そのものであると言えます。

### リアルタイム 3DCG

リアルタイム 3DCG と言っても、コンピュータによる映像生成に全く時間がかからないわけではありません。確かに、プレイヤーがゲームに没入するには、プレイヤーの操作に画面表示が遅れなく追従している必要があります。しかし、人間の視覚は一定より短い時間間隔で発生する情景の変化を知覚することができません。したがって、人間が変化を知覚できない時間間隔の上限が、リアルタイム 3DCG を生成する際の制限時間になります。

映像生成にかかる時間がこの制限時間を超えてしまうと、ゲームのユーザ体験が大きく損なわれてしまいます。そのためゲームグラフィックスでは、映像の品質よりも処理時間が優先されます。とは言っても、映像の品質自体もゲームの価値を構成します。したがって、この制限時間内で最大の映像品質を目指すことが、ゲームグラフィックスにおける技術開発の目標になります。

コンピュータによる映像生成は、以前は主としてソフトウェアで行われていました。これは映像生成の手順が複雑で、それを実行できるグラフィックスハードウェアの開発が困難であるか、開発できたとしてもコストが非常に高かったことが原因でした。しかしソフトウェアによる映像生成は、一般に専用のグラフィックスハードウェアを用いるより時間がかかります。そのため、制限時間内に映像生成を完了することと引き換えに、映像の品質を犠牲にしなければならないこともありました。また、映像生成に時間を取られることによって、物理シミュレーションなどの映像生成以外の処理に制限が加わることもありました。

コンピュータのハードウェア技術が進み、映像生成専用のグラフィックスハードウェアが低価格で実現できるようになって、リアルタイム 3DCG は日常生活でも一般的なものになりました。現在のリアルタイム 3DCG 技術は、このようなグラフィックスハードウェアの支援を用いることを前提にしています。このため現在のリアルタイム CG の技術開発では、いかにグラフィックスハードウェアの機能を活用して映像生成の速度や品質を向上するかが、目標のひとつになっています。また、そのような技術開発の蓄積をもとに、新たなグラフィックスハードウェアの機能を要求し、開発することも継続的に行われています。ソフトウェアの技術開発とハードウェアの技術開発は、リアルタイム3DCG技術の進歩の両輪なのです。

### なぜゲームグラフィックスなのか

コンピュータサイエンスの中で、3DCG は人気のある分野のひとつです。しかし現実には、3DCG の応用分野は、これまでそれほど広いとは考えられていませんでした。特に、生成される映像のリアルさと引き換えに時間を潤沢に使えるような応用は、映画などの限られた分野にしか存在しないと思われてきました。また、これは 3DCG が応用されている分野として一般的に知られている映像制作やゲームがエンターテイメントの領域にあり、「ものづくり」第一主義である日本の産業の中では傍流にあると見なされていたということもあったのかもしれません。

しかし、「ものづくり」の中でも、CAD (コンピュータ支援設計) や CAE (コンピュータ支援工学) などの分野では、3DCG は非常に重要な技術です。それに現在のパソコンのユーザインタフェースの部分でも、内部的に 3DCG の技術が使われています。ユーザの操作に対して即座に応答を返すというリアルタイム 3DCG の特性は、手元での対話的処理が重視されるであろう今後のコンピュータのユーザインタフェース技術の核となるものです。

そもそも CG 技術の原点である Sutherland の Sketchpad は、コンピュータと人間との図形による対話 (interaction) を目指したシステムでした。このような CG はインタラクティブコンピュータグラフィックスと呼ばれ、CG 本来の目的でもあります。この点でもゲームグラフィックスは、これからのコンピュータの応用技術の基盤となるものだと考えています。

## リアルタイム 3DCG の技術開発

### グラフィックスハードウェアと CG 技術

近年のグラフィックスハードウェアの性能向上と価格低下には目を見張るものがあります。現在ではグラフィックスハードウェアは、パソコンに限らずスマートフォンやタブレット端末などのモバイルデバイスまで、ありとあらゆる情報機器に搭載されています。さまざまな局面でリアルタイム 3DCG が利用可能になった結果、AR (拡張現実感) を応用したものなど、これまでの枠にとらわれないグラフィックスのアプリケーションが提案されるようになりました。

また、グラフィックスハードウェアの機能自体も近年大きく向上し、できることも増えました。特に実数演算ハードウェアを搭載した GPU (Graphics Processing Unit) の登場と、そのプログラマブル化は、新技術をハードウェア処理の高速性を損なうことなくソフトウェア的に実装することを可能にしました。このことはグラフィックスハードウェアを使いこなすための技術開発の重要性を高めたと同時に、グラフィックスハードウェアをグラフィックス以外の汎用的な処理に活用する、いわゆる GPGPU (General Purpose GPU) への道を開きました。

### 技術開発のステップ

リアルタイム 3DCG といえども、用いられるソフトウェア開発の技法は、他の一般的なソフトウェアと変わりはありません。重視すべき点を挙げるとすれば、それがユーザに何らかの体験を与える、ひとつの表現につながるものである、というところでしょうか。そして、その表現のためには、表現を生み出すもととなる対象や現象のモデル化が不可欠になります (図 1)。

ところがこのモデル化は、仮に自然現象や物理現象の再現を目的としたものであっても、ゲームグラフィックスは一般的な科学技術計算とは異なり、必ずしも「真の解」を求めようとするものではありません。求められているのは表現のための手法であるため、デザイナが現象の制御を行える仕組みを用意しなければならない場合もあります。

図 1 CG の技術開発のステップ

### ゲーム開発に必要な知識

ゲームや CG の技術開発は、その目的が表現であるがゆえに、非常に多くの要素を含みます。空間や立体形状を取り扱うという点では、幾何学や線形代数などの数学の領域の知識が必要になります。現象のモデル化には、微分方程式が必須です。照明や運動を取り扱うには、物理の知識が必要になります。

さらに、ゲームの対戦相手は人間に限りませんから、人工知能の技術も利用されます。もちろん、これらをソフトウェアとして実装するには、アルゴリズムの知識も必要になります。グラフィックスハードウェアやコントローラなどのユーザインタフェース機器の取り扱いには、システムプログラミングの知識も求められます。近年のゲームはオンラインサービスの上に構築されますから、ネットワークの知識も重要です。そして、このように多様な要素を持つ大規模なソフトウェアを開発する場合には、ソフトウェアエンジニアリングの成果も利用すべきでしょう。

また、ゲームの中には、ゲームのシナリオをデータとして内包するものもありますが、そのために専用のスクリプト言語 (プログラミング言語) を用意する場合もあります。グラフィックスハードウェアを効果的に制御するには、そのためのグラフィックスライブラリやミドルウェアを活用する知識が必要になるだけでなく、その特性に合わせた特殊なプログラミング技術が必要になる場合もあります。また、最近のゲームはネットワークと組み合わせてサービスを展開していますから、ネットワーク技術やそのためのシステムに関する知識も要求されます。

- 数学

- 物理学

- 人工知能

- アルゴリズム

- プログラム開発技法

- 言語処理系の実装の知識

- グラフィックスライブラリ/ ミドルウェア

- システムプログラミング / ネットワークプログラミング

- そして、もちろん英語 (最新の技術情報は英語で入ってくる)

このように考えると、ゲームプログラマは何でもできるスーパープログラマのように思えますが、実際、活躍している人達はそんな人達です。もちろん、大規模なソフトェアを一人で開発するようなことはありませんから、これらのすべてを完璧に習得しておかなければならないとは言いません。でも、新しいもの生み出すためには、基本的な知識は持っておくべきでしょう。

## OpenGL

ハードウェア技術の向上によって、グラフィックスハードウェアは、パソコンの CPU に匹敵する、あるいはそれ以上の複雑さを持つようになりました。そのため、これを有効に活用するには、グラフィックス表示に要求される機能を整理し、グラフィックスハードウェアの機能を抽象化する、高機能なグラフィックスライブラリが必要になります。

グラフィックスライブラリの中には、コンピュータのハードウェア全体を制御するオペレーティングシステム (OS) の機能の一部として提供されるものがあります。アプリケーションプログラムはこれを介してグラフィックスハードウェアを制御するので、このようなグラフィックスライブラリはアプリケーションプログラムインタフェース (API) と呼ばれます。パソコンのOSとして最も普及している Microsoft 社の Windows には、一般的な2次元のグラフィックス表示を行う Graphics Device Interface (GDI) や、リアルタイム 3DCG 表示機能を包含した DirectX (リアルタイム 3DCG 部分はDirect3D) というグラフィックス API が用意されています。

ところが Windows には、さらにもうひとつ別の OpenGL と呼ばれるグラフィックス API が用意されています。OpenGL は Microsoft 社が DirectX を用意する前から Windows に組み込まれていた、リアルタイム 3DCG に対応したグラフィックス API です。

OpenGL はもともと当時の Silicon Graphics 社が中心になって開発したグラフィックス API です。同社は IRIX と呼ばれる UNIX 系 OS を搭載した、エンジニアリングワークステーション (EWS) のメーカーでした。OpenGL は同社の EWS のグラフィックス表示に用いられていたグラフィックスライブラリ (当時は GL と呼ばれていましたが、現在は OpenGL と区別するために IRIS GL と呼ばれることがあります) を、プラットホーム (ハードウェアや OS などのコンピュータの基盤) に依存する部分を分離して再実装したものです。

その後、1992年に OpenGL の仕様の決定が複数の EWS メーカーが参加する OpenGL Architecture Review Board (ARB) という団体に移された後、2006年に The Khronos Group という標準化団体に管理が移されました。現在 OpenGL の仕様は、その OpenGL ARB Working Group (OpenGL ARB WG) によって決定されています。

ところで、EWS は主に CAD などの技術的用途に用いられるコンピュータですが、パソコンが性能向上によりこの目的にも使用されるようなりました。その結果、EWS で動作していたアプリケーションをパソコンに移行するために、Windows 上にも OpenGL が移植されました。

当時はこれら以外のグラフィックスライブラリもありましたが、パソコン用 OS の Windows による寡占化が進んだ結果、グラフィックスライブラリも DirectX と OpenGL の二つ以外のものは、実質的に淘汰されてしまいました。このうち DirectX は Microsoft 社の専有物のため、OS として Windows を採用しているパソコン以外で共通に使用できるグラフィックスライブラリは、事実上 OpenGL しかありませんでした。しかし、これは言い換えれば、Windows パソコン以外のコンピュータ関連機器のほとんどが、3DCG 用のグラフィックス API として OpenGL (または組み込み機器向けのOpenGL ES) を採用していることになります。

OpenGL がこのように広く使われるようになった背景には、もちろん OpenGL しか選択肢がなかったということもありますが、その仕様がプラットホームとは独立していることも大きな理由だと考えられます。そのため、OpenGL はさまざまな機器に導入されました。Apple 社のパソコンの OS である Mac OS X や、UNIX あるいは Linux の画面表示に用いられている X Window System でも、OpenGL が使われています。またパソコンに限らず、スマートフォンの OS である Apple 社の iOS や Google 社の Android も、OpenGL ES を採用しています。

しかし、その OpenGL も設計の古さから、現在のグラフィックスハードウェアの性能を活かしきれなくなっています。そのため Apple 社は 2014 年に METAL というグラフィックス API を開発し、macOS や iOS/iPadOS 上での OpenGL の利用を非推奨としました。また The Khronos Group は、2016 年に OpenGL 後継のグラフィックス API として Vulkan を発表しました。

## GLFW

### OpenGL とツールキット

OpenGL はプラットホームに依存しないグラフィックス API ですが、アプリケーションプログラムからこの機能を使用するためには、やはりプラットホームごとに異なる手順で「お膳立て」をする必要があります。しかし、その部分の実装はそれなりに面倒なものになるため、それをうまく包み隠して簡単に使えるようにしたツールキットがいくつも提案されています。

中でも GLUT (OpenGL Utility Toolkit) は、OpenGL を開発した Silicon Graphics のエンジニア (当時) が作った、使いやすいツールキットです。また GLUT はマルチプラットホームに対応しているため、これを使ったソースプログラムは Unix / Linux、Windows、Mac OS X の間で共通にすることができます。GLUT は OpenGL の初期の頃に作られたものですが、OpenGL の学習や OpenGL を使った簡単なプログラムの作成を手軽に始めることができるため、今でも有用なツールキットとして利用されています。

しかし、オリジナルの GLUT は既に長い間メンテナンスされていません。代わりに GLUT 互換の freeglut や OpenGLUT というツールキットが開発されていますが、これらはMac OS X には対応していません。また、Mac OS X に標準で搭載されている GLUT は OpenGL 2.1 にしか対応しておらず、Mac OS X のバージョン 10.7 (Lion) 以降で使用可能になった OpenGL 3.2 Core Profile や、10.9 (Mavericks) 以降で使用可能になった OpenGL 4.1 を (公式には) 使用することができません。加えて 10.9 では、ついに GLUT の使用自体が非推奨になりました。

### GLFW というツールキット

OpenGL に対応していて GLUT のようにマルチプラットホームで使用できるツールキットには、[FLTK](http://www.fltk.org/) や [Qt](http://qt.nokia.com/title-jp/)、[SDL](http://www.libsdl.org/) などがあります。中でも Qt は非常に高機能なツールキットであり、3DCG 関連のいくつかの主要なアプリケーションがこれを使って開発されています。しかし、OpenGL の学習のための短いプログラムを作成するには、Qt はちょっと規模が大きすぎる気がします。そこで GLUT の代わりに使える簡単で小さなツールキットとして [GLFW](http://www.glfw.org/) があります。

GLFW のプロジェクトのホームページ (<http://www.glfw.org/>) には、「GLFW はウィンドウを作成し、OpenGL のコンテキストを作って、入力 (デバイス) を管理する、無料の、オープンソースの、マルチプラットホームのライブラリである」と書いてあります。ライセンスは zlib/libpng license を採用しています[^1]。

### GLFW の特徴

GLFW は、次のような特徴を持っています。

#### マルチプラットホームである

GLUT と同様に Windows / Mac OS X / Linux でソースを共通化することができます。

#### OpenGL のバージョンやプロファイルが指定できる

Mac OS X バージョン 10.7 (Lion) 以降では、OpenGL のバージョン 3.2 の Core Profile を指定することができます。

#### コールバックベースではない

イベントループを自分で書くことができます。GLUT と同様なコールバック形式で書くこともできます。

#### 最初からダブルバッファリングになっている

明示的にイベントを待つようにプログラムを書かなければイベントループが回り続けるので、アニメーション表示が基本になります。またイベントの取得はダブルバッファリングのバッファの入れ替えの際に行われるため、コールバック形式でプログラミングする場合もイベントループは自分で用意しておく必要があります。

#### 入力デバイスの取り扱い方法が異なる

キーボードからの入力は GLUT のように文字として得られるほか、押されているキーそのものを知ることもできます。また、マウスホイールやジョイスティックのデータを取得することもできます。

#### その他の機能

このほか、GLUT ではちょっとネックになっていたテクスチャ用の画像を読み込む機能が用意されています。また、スレッド (並行処理) やミューテックス (同期機構) が用意されているため、他のデバイスからのデータ入力やサウンドとの組み合わせが容易になります。それともうひとつ、Mac OS X の GLUT では無効になっていた、ウィンドウのクローズボタンが有効になります。

#### GLFW にない機能

一方、GLUT にあって GLFW にない機能もいくつかあります。例えば、Cube や Sphere、Teapot のような図形を表示する機能は省かれています。またビットマップフォントをレンダリングする機能もありません。ポップアップメニューを表示する機能も用意されていません[^2]。

最初からダブルバッファリングになっていることや、マウスやキーボード、ジョイスティックの扱い方を見ると、GLFW は GLUT に比べて、かなりゲーム向きに作られているように思われます。また、GLUT にあって GLFW に無い機能の多くは、OpenGL の Core Profile では使えない機能を使っています。Mac OS X の GLUT が OpenGL の Legacy Profile、すなわち OpenGL 2.1 にしか対応していないのは、このような問題があるからかも知れません。

#### ドキュメント

GLFW に添付されているReference や User Guide は非常にわかりやすいので、ぜひ目を通してください。
